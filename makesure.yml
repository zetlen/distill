# yaml-language-server: $schema=./makesure-schema.json
checksets:
  - include: 'package.json'
    checks:
      - actions:
          - urgency: 0
            template: |
              # A dependency has changed

              A dependency (besides the frequently-iterating "workerd" lib) has changed.

              ```diff
              {{diffText}}
              ```
        filters:
          - type: 'jq'
            query: '.dependencies | del(.workerd)'
  - include: 'src/commands/**/*.ts'
    checks:
      - actions:
          - urgency: 0
            template: |
              # Oclif command args have been modified.

              ```diff
              {{diffText}}
              ```
        filters:
          - type: 'ast-grep'
            language: typescript
            pattern:
              selector: public_field_definition
              context: 'class C { static override args = $ARGS }'
      - actions:
          - urgency: 0
            template: |
              # Oclif command flags have been modified.

              ```diff
              {{diffText}}
              ```
        filters:
          - type: 'ast-grep'
            language: typescript
            pattern:
              selector: public_field_definition
              context: 'class C { static override flags = $FLAGS }'
  - include: 'README.md'
    checks:
      - actions:
          - urgency: 1
            template: |
              # Commands section of readme has changed.

              ```diff
              {{diffText}}
              ```
        filters:
          - type: 'regex'
            pattern: "\\n<!-- commands -->.+\\n<!-- commandsstop -->"
            flags: 's'
