{
  "$ref": "#/definitions/TiltshiftConfig",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "definitions": {
    "AstGrepFilterConfig": {
      "additionalProperties": false,
      "description": "Configuration for the ast-grep filter. Extracts AST nodes from source code using ast-grep's pattern syntax. Patterns look like actual code with metavariables ($VAR) for wildcards.",
      "properties": {
        "language": {
          "description": "The language to parse the code as. Required for accurate AST parsing.",
          "type": "string"
        },
        "pattern": {
          "anyOf": [
            {
              "$ref": "#/definitions/AstGrepPatternObject"
            },
            {
              "type": "string"
            }
          ],
          "description": "The pattern to match against. Can be a simple string pattern or an object with context and selector for precise matching."
        },
        "type": {
          "const": "ast-grep",
          "description": "Discriminant tag identifying this as an ast-grep filter.",
          "type": "string"
        }
      },
      "required": ["language", "pattern", "type"],
      "type": "object"
    },
    "AstGrepPatternObject": {
      "additionalProperties": false,
      "description": "Pattern object for ast-grep with context and selector. Used for precise matching within specific AST structures.",
      "properties": {
        "context": {
          "description": "Full code snippet providing context for parsing. This helps ast-grep understand the syntactic structure.",
          "type": "string"
        },
        "selector": {
          "description": "AST node type to select from the matched context. Ensures precise targeting of specific syntax elements.",
          "type": "string"
        }
      },
      "required": ["context", "selector"],
      "type": "object"
    },
    "DefinedBlock": {
      "additionalProperties": false,
      "description": "Block of reusable definitions that can be referenced via UseReference.",
      "properties": {
        "focuses": {
          "additionalProperties": {
            "$ref": "#/definitions/FocusConfig"
          },
          "description": "Reusable focus configurations. Reference with: { use: \"#defined/focuses/<name>\" }",
          "type": "object"
        },
        "projections": {
          "additionalProperties": {
            "$ref": "#/definitions/Projection"
          },
          "description": "Reusable projection configurations. Reference with: { use: \"#defined/projections/<name>\" }",
          "type": "object"
        },
        "viewers": {
          "additionalProperties": {
            "$ref": "#/definitions/Viewer"
          },
          "description": "Reusable viewer configurations. Reference with: { use: \"#defined/viewers/<name>\" }",
          "type": "object"
        }
      },
      "type": "object"
    },
    "FocusConfig": {
      "anyOf": [
        {
          "$ref": "#/definitions/AstGrepFilterConfig"
        },
        {
          "$ref": "#/definitions/JqFilterConfig"
        },
        {
          "$ref": "#/definitions/RegexFilterConfig"
        },
        {
          "$ref": "#/definitions/TsqFilterConfig"
        },
        {
          "$ref": "#/definitions/XPathFilterConfig"
        }
      ],
      "description": "Union type of all supported focus configurations. Each focus type has its own specific properties with the 'type' field as discriminant."
    },
    "FocusRef": {
      "anyOf": [
        {
          "$ref": "#/definitions/FocusConfig"
        },
        {
          "$ref": "#/definitions/UseReference"
        }
      ],
      "description": "Either an inline item or a reference to a defined item."
    },
    "JqFilterConfig": {
      "additionalProperties": false,
      "description": "Configuration for the jq filter. Uses the jq command-line tool to extract/transform JSON content.",
      "properties": {
        "query": {
          "description": "The jq query expression to apply to JSON content. See https://jqlang.github.io/jq/manual/ for syntax reference.",
          "examples": [
            ".version",
            ".dependencies | keys",
            ".scripts | to_entries | map(select(.key | startswith(\"test\")))"
          ],
          "type": "string"
        },
        "type": {
          "const": "jq",
          "description": "Discriminant tag identifying this as a jq filter.",
          "type": "string"
        }
      },
      "required": ["query", "type"],
      "type": "object"
    },
    "Projection": {
      "additionalProperties": false,
      "description": "A projection defines a file pattern, focuses to apply, and viewers to execute. This combines what was previously split between FileCheckset and Check.",
      "properties": {
        "focuses": {
          "description": "Focuses to apply to the file content. Each focus processes the file and produces artifacts for comparison. If all focuses produce a meaningful diff, the viewers are triggered. Can be inline configurations or references to defined focuses.",
          "items": {
            "$ref": "#/definitions/FocusRef"
          },
          "type": "array"
        },
        "include": {
          "description": "Glob pattern for files to which this projection applies. Uses minimatch syntax for pattern matching.",
          "type": "string"
        },
        "viewers": {
          "description": "Viewers to run when the projection is triggered. Will run once per file that matches the projection's focuses. Can be inline configurations or references to defined viewers.",
          "items": {
            "$ref": "#/definitions/ViewerRef"
          },
          "type": "array"
        }
      },
      "required": ["focuses", "include", "viewers"],
      "type": "object"
    },
    "ProjectionRef": {
      "anyOf": [
        {
          "$ref": "#/definitions/Projection"
        },
        {
          "$ref": "#/definitions/UseReference"
        }
      ],
      "description": "Either an inline projection or a reference to a defined projection."
    },
    "RegexFilterConfig": {
      "additionalProperties": false,
      "description": "Configuration for the regex filter. Extracts content matching a regular expression pattern.",
      "properties": {
        "flags": {
          "description": "Optional regex flags to modify matching behavior. The 'g' (global) and 'm' (multiline) flags are always applied automatically.\n\nCommon flags:\n- 'i': Case-insensitive matching\n- 's': Dot matches newlines (dotAll mode)\n- 'u': Unicode mode",
          "examples": ["i", "iu"],
          "type": "string"
        },
        "pattern": {
          "description": "The regular expression pattern to match. Uses JavaScript regex syntax.",
          "examples": ["API_KEY=.*", "version\\s*=\\s*\\d+\\.\\d+\\.\\d+", "import\\s+\\{[^}]+\\}\\s+from"],
          "type": "string"
        },
        "type": {
          "const": "regex",
          "description": "Discriminant tag identifying this as a regex filter.",
          "type": "string"
        }
      },
      "required": ["pattern", "type"],
      "type": "object"
    },
    "ReportViewer": {
      "additionalProperties": false,
      "description": "A \"report\" viewer produces a text report about the change. It can be routed many places, including to stdout or an API call (for example, a GitHub comment).",
      "properties": {
        "template": {
          "description": "Handlebars template for the comment to produce. Accepts markdown, and receives a FocusResult as its evaluation context.",
          "type": "string"
        },
        "type": {
          "const": "report",
          "description": "Discriminant for tagged union. Implied when 'template' is present.",
          "type": "string"
        }
      },
      "required": ["template"],
      "type": "object"
    },
    "RunViewer": {
      "additionalProperties": false,
      "description": "A \"run\" viewer runs an arbitrary command that receives details about the change as environment variables.",
      "properties": {
        "args": {
          "description": "If the command requires arguments, they can be evaluated here as Handlebars templates which receive a FocusResult as evaluation context.",
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "command": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            }
          ],
          "description": "Path to the command. Can be a string or an array of strings which will be evaluated as arguments to produce the command path."
        },
        "env": {
          "additionalProperties": {
            "type": "string"
          },
          "description": "If the default environment variables don't suffice, you can define new ones as Handlebars templates which receive a FocusResult as evaluation context.",
          "type": "object"
        },
        "type": {
          "const": "run",
          "description": "Discriminant for tagged union. Implied when 'command' is present.",
          "type": "string"
        }
      },
      "required": ["args", "command", "env"],
      "type": "object"
    },
    "Stakeholder": {
      "additionalProperties": false,
      "description": "A stakeholder interested in a set of subjects.",
      "properties": {
        "contactMethod": {
          "description": "How to contact the stakeholder. Examples: \"github-comment-mention\", \"github-reviewer-request\", \"github-assign\", \"webhook\".",
          "type": "string"
        },
        "description": {
          "description": "A description of the stakeholder's role or interest.",
          "type": "string"
        },
        "name": {
          "description": "The name of the stakeholder (e.g. a team or person).",
          "type": "string"
        }
      },
      "required": ["contactMethod", "name"],
      "type": "object"
    },
    "Subject": {
      "additionalProperties": false,
      "description": "A subject represents a specific area of interest or domain in the project. Projections are attached to subjects to define what to monitor.",
      "properties": {
        "projections": {
          "description": "Projections attached to this subject. Can be inline definitions or references to defined projections.",
          "items": {
            "$ref": "#/definitions/ProjectionRef"
          },
          "type": "array"
        },
        "stakeholders": {
          "description": "List of stakeholders associated with this subject.",
          "items": {
            "$ref": "#/definitions/Stakeholder"
          },
          "type": "array"
        }
      },
      "required": ["projections", "stakeholders"],
      "type": "object"
    },
    "SupportedExtension": {
      "type": ["string"]
    },
    "TiltshiftConfig": {
      "additionalProperties": false,
      "description": "Root configuration interface for tiltshift.yml files. Subjects contain projections that define how to process git diffs.",
      "properties": {
        "defined": {
          "$ref": "#/definitions/DefinedBlock",
          "description": "Reusable definitions that can be referenced throughout the configuration."
        },
        "subjects": {
          "additionalProperties": {
            "$ref": "#/definitions/Subject"
          },
          "description": "Dictionary of subjects defined in the project. Keys are subject IDs.",
          "type": "object"
        }
      },
      "required": ["subjects"],
      "type": "object"
    },
    "TsqFilterConfig": {
      "additionalProperties": false,
      "description": "Configuration for the tsq (tree-sitter query) filter. Extracts AST nodes from source code using tree-sitter's S-expression query syntax. This enables language-aware code analysis for tracking changes to specific code constructs.",
      "properties": {
        "capture": {
          "description": "Optional capture name to filter results. When specified, only nodes matching this capture name will be extracted. If omitted, all captures from the query will be included.",
          "examples": ["fn", "class-name", "method"],
          "type": "string"
        },
        "language": {
          "$ref": "#/definitions/TsqSupportedExtension",
          "description": "Optional file extension to override language detection. By default, the language is detected from the file being processed. Use this when processing files with non-standard extensions.\n\nSupported extensions: .js, .jsx, .mjs, .ts, .tsx, .py, .go, .java, .rs, .c, .h, .cpp, .cxx, .hpp, .json",
          "examples": [".js", ".py", ".ts"]
        },
        "query": {
          "description": "The tree-sitter query pattern using S-expression syntax. See https://tree-sitter.github.io/tree-sitter/using-parsers/queries for syntax reference.\n\nCommon patterns:\n- `(node_type)",
          "type": "string"
        },
        "type": {
          "const": "tsq",
          "description": "Discriminant tag identifying this as a tsq filter.",
          "type": "string"
        }
      },
      "required": ["query", "type"],
      "type": "object"
    },
    "TsqSupportedExtension": {
      "$ref": "#/definitions/SupportedExtension"
    },
    "UpdateSubjectContextViewer": {
      "additionalProperties": false,
      "description": "A viewer that updates the shared context of the subjects attached to the projection.",
      "properties": {
        "set": {
          "additionalProperties": {
            "type": "string"
          },
          "description": "Key-value pairs to set in the subject context. Values can be Handlebars templates which receive a FocusResult as evaluation context.",
          "type": "object"
        },
        "type": {
          "const": "set",
          "description": "Discriminant for tagged union. Implied when 'set' is present.",
          "type": "string"
        }
      },
      "required": ["set"],
      "type": "object"
    },
    "UseReference": {
      "additionalProperties": false,
      "description": "A reference to a defined item in the `defined` block. Format: \"#defined/<type>/<name>\" where type is projections, focuses, or viewers.",
      "properties": {
        "use": {
          "type": "string"
        }
      },
      "required": ["use"],
      "type": "object"
    },
    "Viewer": {
      "anyOf": [
        {
          "$ref": "#/definitions/ReportViewer"
        },
        {
          "$ref": "#/definitions/RunViewer"
        },
        {
          "$ref": "#/definitions/UpdateSubjectContextViewer"
        }
      ],
      "description": "Union type of all supported viewers. Viewers can be discriminated by:\n- 'template' property -> ReportViewer\n- 'command' property -> RunViewer\n- 'set' property -> UpdateSubjectContextViewer"
    },
    "ViewerRef": {
      "anyOf": [
        {
          "$ref": "#/definitions/UseReference"
        },
        {
          "$ref": "#/definitions/Viewer"
        }
      ]
    },
    "XPathFilterConfig": {
      "additionalProperties": false,
      "description": "Configuration for the xpath filter. Extracts nodes from XML/HTML content using XPath expressions.",
      "properties": {
        "expression": {
          "description": "The XPath expression to evaluate against the XML/HTML content. See https://www.w3.org/TR/xpath/ for syntax reference.",
          "examples": ["//version", "//dependency[groupId='com.example']/version", "string(//project/version)"],
          "type": "string"
        },
        "namespaces": {
          "additionalProperties": {
            "type": "string"
          },
          "description": "Optional namespace prefix mappings for XPath expressions. Maps prefix strings to namespace URI strings. Required when querying XML documents with namespaces.",
          "examples": [
            {
              "m": "http://maven.apache.org/POM/4.0.0"
            },
            {
              "svg": "http://www.w3.org/2000/svg",
              "xhtml": "http://www.w3.org/1999/xhtml"
            }
          ],
          "type": "object"
        },
        "type": {
          "const": "xpath",
          "description": "Discriminant tag identifying this as an xpath filter.",
          "type": "string"
        }
      },
      "required": ["expression", "type"],
      "type": "object"
    }
  }
}
